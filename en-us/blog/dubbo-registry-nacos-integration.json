{
  "filename": "dubbo-registry-nacos-integration.md",
  "__html": "<h1>Dubbo Integrates with Nacos to Become a Registry</h1>\n<p>Nacos is an important registry in Dubbo ecosystem, and dubbo-registry-nacos is the implementation of Dubbo-integrated Nacos registry.</p>\n<h2>Preparation Works</h2>\n<p>Before you integrate dubbo-registry-nacos into your Dubbo project, make sure the Nacos service is started in the background. If you are not familiar with the basic use of Nacos, you can refer to the Quick Start for Nacos: <a href=\"https://nacos.io/en-us/docs/quick-start.html\">https://nacos.io/en-us/docs/quick-start.html</a>. Nacos versions above 0.6.1 are recommended.</p>\n<h2>Get Started Quickly</h2>\n<p>The operation steps for Dubbo to integrate Nacos into a registry are simple, the general steps can be divided into &quot;add Maven dependency&quot; and &quot;configure the registry.&quot;</p>\n<h2>Increase Maven Dependency</h2>\n<p>First, you need to add the Maven dependency of dubbo-registry-nacos to your project's pom.xml file, and it is strongly recommended that you use Dubbo 2.6.5:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span>\n\n    ...\n        \n    <span class=\"hljs-comment\">&lt;!-- Dubbo Nacos registry dependency --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>dubbo-registry-nacos<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>   \n    \n    <span class=\"hljs-comment\">&lt;!-- Keep latest Nacos client version --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.nacos<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>nacos-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>[0.6.1,)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-comment\">&lt;!-- Dubbo dependency --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.6.5<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-comment\">&lt;!-- Alibaba Spring Context extension --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-context-support<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.0.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n    ...\n    \n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</code></pre>\n<p>When you add dubbo-registry-nacos to your project, you don't need to programmatically implement the service discovery and registration logic, the actual implementation is provided by the third-party package, and then to configure the Naocs registry.</p>\n<h2>Configure the Registry</h2>\n<p>Assuming your Dubbo application is assembled by the Spring Framework, there are two configuration options: Dubbo Spring externalization configuration and Spring XML configuration files, I strongly recommend the former.</p>\n<h2>Dubbo Spring Externalization Configuration</h2>\n<p>Dubbo Spring externalization configuration is a new feature introduced by Dubbo 2.5.8, which automatically generates and binds Dubbo configuration Bean through the Spring Environment property, simplifying configuration and lowering the threshold for microservice development.</p>\n<p>Assume your Dubbo application uses Zookeeper as the registry and its server IP address is 10.20.153.10, the registered address is also stored in the dubbo-config.properties file as a Dubbo externalization configuration attribute, as shown below:</p>\n<pre><code class=\"language-properties\"><span class=\"hljs-comment\">## application</span>\n<span class=\"hljs-meta\">dubbo.application.name</span> = <span class=\"hljs-string\">your-dubbo-application</span>\n<span class=\"hljs-comment\">\n## Zookeeper registry address</span>\n<span class=\"hljs-meta\">dubbo.registry.address</span> = <span class=\"hljs-string\">zookeeper://10.20.153.10:2181</span>\n<span class=\"hljs-attr\">...</span>\n</code></pre>\n<p>Assuming your Nacos Server is also running on server 10.20.153.10 and using the default Nacos service port 8848, you can simply adjust the dubbo.registry.address property as follows:</p>\n<pre><code class=\"language-properties\"><span class=\"hljs-comment\">## 其他属性保持不变</span>\n<span class=\"hljs-comment\">\n## Nacos registry address</span>\n<span class=\"hljs-meta\">dubbo.registry.address</span> = <span class=\"hljs-string\">nacos://10.20.153.10:8848</span>\n<span class=\"hljs-attr\">...</span>\n</code></pre>\n<p>Subsequently, restart your Dubbo application, and Dubbo's service delivery and consumption information can be displayed in the Nacos console:</p>\n<p><img src=\"../../img/blog/dubbo-registry-nacos-1.png\" alt=\"image-20181213103845976\"></p>\n<p>As shown in the figure, the service name prefixed with providers: is the meta-information for the service provider, and consumers: represents the meta-information of the service consumer. Click &quot;Details&quot; to view service status details:</p>\n<p><img src=\"../../img/blog/dubbo-registry-nacos-2.png\" alt=\"image-20181213104145998\"></p>\n<p>If you are using the Spring XML configuration file to assemble the Dubbo registry, refer to the next section.</p>\n<h2>Spring XML Configuration File</h2>\n<p>Also, assume your Dubbo application uses Zookeeper as the registry and its server IP address is 10.20.153.10 and assemble the Spring Bean in an XML file, as shown below:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n    <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n    <span class=\"hljs-attr\">xmlns:dubbo</span>=<span class=\"hljs-string\">\"http://dubbo.apache.org/schema/dubbo\"</span>\n    <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"</span>&gt;</span>\n \n    <span class=\"hljs-comment\">&lt;!-- Provider application information for dependency calculation --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:application</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"dubbo-provider-xml-demo\"</span>  /&gt;</span>\n \n    <span class=\"hljs-comment\">&lt;!-- Using the Zookeeper registry Zookeeper   --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"zookeeper://10.20.153.10:2181\"</span> /&gt;</span>\n \t...\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n</code></pre>\n<p>Similar to the Dubbo Spring externalization configuration, simply adjust the address property configuration:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n    <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n    <span class=\"hljs-attr\">xmlns:dubbo</span>=<span class=\"hljs-string\">\"http://dubbo.apache.org/schema/dubbo\"</span>\n    <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"</span>&gt;</span>\n \n    <span class=\"hljs-comment\">&lt;!-- Provider application information for dependency calculation--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:application</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"dubbo-provider-xml-demo\"</span>  /&gt;</span>\n \n    <span class=\"hljs-comment\">&lt;!-- Using the Nacos registry  --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"nacos://10.20.153.10:8848\"</span> /&gt;</span>\n \t...\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n</code></pre>\n<p>Once you restart the Dubbo application, you can also see that the registration meta-information for both service providers and consumers is presented in the Nacos console:</p>\n<p><img src=\"../../img/blog/dubbo-registry-nacos-3.png\" alt=\"image-20181213113049185\"></p>\n<p>Do you absolutely configure or switch Nacos registry super Easy? If you want to get more or unclear, refer to the complete example below.</p>\n<h2>Complete Example</h2>\n<p>The metadata in the above image is derived from the Dubbo Spring annotation-driven example and the Dubbo Spring XML configuration-driven example, both of which will be described below, you can choose your preferred programming model. Before we get into the formal discussion, let's look at the preparations for both, as they both rely on Java service interfaces and implementations. Also, ensure that the Nacos service is started in the local (127.0.0.1) environment.</p>\n<h3>Example Interfaces and Implementations</h3>\n<p>First, define the sample interface, as follows:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.service;\n\n<span class=\"hljs-comment\">/**\n * DemoService\n *\n * <span class=\"hljs-doctag\">@since</span> 2.7.4\n */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">DemoService</span> </span>{\n\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">sayName</span><span class=\"hljs-params\">(String name)</span></span>;\n\n}\n</code></pre>\n<p>Provide implementation classes for the above interfaces:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.service;\n\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.config.annotation.Service;\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.rpc.RpcContext;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;\n\n<span class=\"hljs-comment\">/**\n * Default {<span class=\"hljs-doctag\">@link</span> DemoService}\n *\n * <span class=\"hljs-doctag\">@since</span> 2.7.4\n */</span>\n<span class=\"hljs-meta\">@Service</span>(version = <span class=\"hljs-string\">\"${demo.service.version}\"</span>)\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DefaultService</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">DemoService</span> </span>{\n\n    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"${demo.service.name}\"</span>)\n    <span class=\"hljs-keyword\">private</span> String serviceName;\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">sayName</span><span class=\"hljs-params\">(String name)</span> </span>{\n        RpcContext rpcContext = RpcContext.getContext();\n        <span class=\"hljs-keyword\">return</span> String.format(<span class=\"hljs-string\">\"Service [name :%s , port : %d] %s(\\\"%s\\\") : Hello,%s\"</span>,\n                serviceName,\n                rpcContext.getLocalPort(),\n                rpcContext.getMethodName(),\n                name,\n                name);\n    }\n}\n</code></pre>\n<p>Once the interface and implementation are ready, the annotation-driven and XML configuration-driven implementations will be used below.</p>\n<h2>Spring Annotation-driven Example</h2>\n<p>Dubbo 2.7.4 reconstructs the Spring annotation-driven programming model.</p>\n<h3>Service Provider Annotation-driven Implementation</h3>\n<ul>\n<li>Define property source of Dubbo provider externalization configuration - provider-config.properties</li>\n</ul>\n<pre><code class=\"language-properties\"><span class=\"hljs-comment\">## application</span>\n<span class=\"hljs-meta\">dubbo.application.name</span> = <span class=\"hljs-string\">dubbo-provider-demo</span>\n<span class=\"hljs-comment\">\n## Nacos registry address</span>\n<span class=\"hljs-meta\">dubbo.registry.address</span> = <span class=\"hljs-string\">nacos://127.0.0.1:8848</span>\n<span class=\"hljs-comment\">\n## Dubbo Protocol</span>\n<span class=\"hljs-meta\">dubbo.protocol.name</span> = <span class=\"hljs-string\">dubbo</span>\n<span class=\"hljs-meta\">dubbo.protocol.port</span> = <span class=\"hljs-string\">-1</span>\n<span class=\"hljs-comment\">\n# Provider @Service version</span>\n<span class=\"hljs-meta\">demo.service.version</span>=<span class=\"hljs-string\">1.0.0</span>\n<span class=\"hljs-meta\">demo.service.name</span> = <span class=\"hljs-string\">demoService</span>\n</code></pre>\n<ul>\n<li>Implement service provider bootstrap - DemoServiceProviderBootstrap</li>\n</ul>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.provider;\n\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.demo.service.DemoService;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.PropertySource;\n\n<span class=\"hljs-keyword\">import</span> java.io.IOException;\n\n<span class=\"hljs-comment\">/**\n * {<span class=\"hljs-doctag\">@link</span> DemoService} provider demo\n */</span>\n<span class=\"hljs-meta\">@EnableDubbo</span>(scanBasePackages = <span class=\"hljs-string\">\"org.apache.dubbo.demo.service\"</span>)\n<span class=\"hljs-meta\">@PropertySource</span>(value = <span class=\"hljs-string\">\"classpath:/provider-config.properties\"</span>)\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DemoServiceProviderBootstrap</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException </span>{\n        AnnotationConfigApplicationContext context = <span class=\"hljs-keyword\">new</span> AnnotationConfigApplicationContext();\n        context.register(DemoServiceProviderBootstrap<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;\n        context.refresh();\n        System.out.println(<span class=\"hljs-string\">\"DemoService provider is starting...\"</span>);\n        System.in.read();\n    }\n}\n\n</code></pre>\n<p>Wherein, the annotation @EnableDubbo activates the Dubbo annotation-driven and externalization configuration, its scanBasePackages property scans the specified Java package, exposes all service interface implementation classes labeled @Service as Spring Bean, and then exports the Dubbo service.</p>\n<p>@PropertySource is the standard import property configuration resource annotation introduced by Spring Framework 3.1, which provides externalization configuration for Dubbo.</p>\n<h2>Service consumer annotation-driven implementation</h2>\n<ul>\n<li>Define property source of Dubbo consumer externalization configuration - consumer-config.properties</li>\n</ul>\n<pre><code class=\"language-properties\"><span class=\"hljs-comment\">## Dubbo Application info</span>\n<span class=\"hljs-meta\">dubbo.application.name</span> = <span class=\"hljs-string\">dubbo-consumer-demo</span>\n<span class=\"hljs-comment\">\n## Nacos registry address</span>\n<span class=\"hljs-meta\">dubbo.registry.address</span> = <span class=\"hljs-string\">nacos://127.0.0.1:8848</span>\n<span class=\"hljs-comment\">\n# @Reference version</span>\n<span class=\"hljs-meta\">demo.service.version</span>= <span class=\"hljs-string\">1.0.0</span>\n</code></pre>\n<p>Similarly, the dubbo.registry.address property points to the Nacos registry, through which metadata about other Dubbo services is obtained.</p>\n<ul>\n<li>Implement service consumer bootstrap class - DemoServiceConsumerBootstrap</li>\n</ul>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.consumer;\n\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.config.annotation.Reference;\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.demo.service.DemoService;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.PropertySource;\n\n<span class=\"hljs-keyword\">import</span> javax.annotation.PostConstruct;\n<span class=\"hljs-keyword\">import</span> java.io.IOException;\n\n<span class=\"hljs-comment\">/**\n * {<span class=\"hljs-doctag\">@link</span> DemoService} consumer demo\n */</span>\n<span class=\"hljs-meta\">@EnableDubbo</span>\n<span class=\"hljs-meta\">@PropertySource</span>(value = <span class=\"hljs-string\">\"classpath:/consumer-config.properties\"</span>)\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DemoServiceConsumerBootstrap</span> </span>{\n\n    <span class=\"hljs-meta\">@Reference</span>(version = <span class=\"hljs-string\">\"${demo.service.version}\"</span>)\n    <span class=\"hljs-keyword\">private</span> DemoService demoService;\n\n    <span class=\"hljs-meta\">@PostConstruct</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">init</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            System.out.println(demoService.sayName(<span class=\"hljs-string\">\"小马哥（mercyblitz）\"</span>));\n        }\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException </span>{\n        AnnotationConfigApplicationContext context = <span class=\"hljs-keyword\">new</span> AnnotationConfigApplicationContext();\n        context.register(DemoServiceConsumerBootstrap<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;\n        context.refresh();\n        context.close();\n    }\n}\n\n</code></pre>\n<p>Similarly, the @EnableDubbo annotation activates the Dubbo annotation-driven and externalization configuration, although it currently belongs to the service consumer and does not require the Java package name to scan the service implementation labeled @Service.</p>\n<p>@Reference is a dependency injection annotation for Dubbo remote services that requires service provider and consumer contract interface, version, and group information. In the current service consumption example, the service version of DemoService is derived from the property configuration file consumer-config.properties.</p>\n<p>The @PostConstruct code shows that when the DemoServiceConsumerBootstrap Bean is initialized, it executes ten Dubbo remote method invocation.</p>\n<h3>Run the Annotation-driven Example</h3>\n<p>Start DemoServiceProviderBootstrap twice locally and the registry will have two health services:</p>\n<p><img src=\"../../img/blog/dubbo-registry-nacos-4.png\" alt=\"image-20181213123909636\"></p>\n<p>Run DemoServiceConsumerBootstrap again and the results are as follows:</p>\n<pre><code>Service [name :demoService , port : 20880] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20881] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20880] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20880] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20881] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20881] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20880] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20880] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20881] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :demoService , port : 20881] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\n</code></pre>\n<p>Run correctly and the service consumer uses a load balancing strategy to allocate ten RPC calls equally to two Dubbo service provider instances.</p>\n<h3>Spring XML Configuration-driven Example</h3>\n<p>Spring XML configuration-driven is the programming model of traditional Spring assembly components.</p>\n<h4>Service Provider XML Configuration-driven</h4>\n<p>Define the service provider XML context configuration file - /META-INF/spring/dubbo-provider-context.xml</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:dubbo</span>=<span class=\"hljs-string\">\"http://dubbo.apache.org/schema/dubbo\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- \n\nProvider application information for dependency calculation\n --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:application</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"dubbo-provider-xml-demo\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Using the Nacos registry --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"nacos://127.0.0.1:8848\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Using Dubbo protocol to expose services on random ports --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:protocol</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"dubbo\"</span> <span class=\"hljs-attr\">port</span>=<span class=\"hljs-string\">\"-1\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Declare the service interface to be exposed --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:service</span> <span class=\"hljs-attr\">interface</span>=<span class=\"hljs-string\">\"org.apache.dubbo.demo.service.DemoService\"</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">\"demoService\"</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">\"2.0.0\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Implement services like local beans --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"demoService\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.apache.dubbo.demo.service.DefaultService\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n</code></pre>\n<ul>\n<li>Implement service provider bootstrap class - DemoServiceProviderBootstrap</li>\n</ul>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.provider;\n\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.demo.service.DemoService;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;\n\n<span class=\"hljs-keyword\">import</span> java.io.IOException;\n\n<span class=\"hljs-comment\">/**\n * {<span class=\"hljs-doctag\">@link</span> DemoService} provider demo XML bootstrap\n */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DemoServiceProviderXmlBootstrap</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException </span>{\n        ClassPathXmlApplicationContext context = <span class=\"hljs-keyword\">new</span> ClassPathXmlApplicationContext();\n        context.setConfigLocation(<span class=\"hljs-string\">\"/META-INF/spring/dubbo-provider-context.xml\"</span>);\n        context.refresh();\n        System.out.println(<span class=\"hljs-string\">\"DemoService provider (XML) is starting...\"</span>);\n        System.in.read();\n    }\n}\n</code></pre>\n<h4>Service Consumer XML Configuration-driven</h4>\n<p>Define the consumer provider XML context configuration file - /META-INF/spring/dubbo- consumer-context.xml</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:dubbo</span>=<span class=\"hljs-string\">\"http://dubbo.apache.org/schema/dubbo\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- \n\nProvider application information for dependency calculation\n --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:application</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"dubbo-consumer-xml-demo\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Using the Nacos registry--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"nacos://127.0.0.1:8848\"</span>/&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- Reference service interface --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:reference</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"demoService\"</span> <span class=\"hljs-attr\">interface</span>=<span class=\"hljs-string\">\"org.apache.dubbo.demo.service.DemoService\"</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">\"2.0.0\"</span>/&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n</code></pre>\n<ul>\n<li>Implement service consumer bootstrap class - DemoServiceConsumerBootstrap</li>\n</ul>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.demo.consumer;\n\n<span class=\"hljs-keyword\">import</span> org.apache.dubbo.demo.service.DemoService;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;\n\n<span class=\"hljs-keyword\">import</span> java.io.IOException;\n\n<span class=\"hljs-comment\">/**\n * {<span class=\"hljs-doctag\">@link</span> DemoService} consumer demo XML bootstrap\n */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DemoServiceConsumerXmlBootstrap</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException </span>{\n        ClassPathXmlApplicationContext context = <span class=\"hljs-keyword\">new</span> ClassPathXmlApplicationContext();\n        context.setConfigLocation(<span class=\"hljs-string\">\"/META-INF/spring/dubbo-consumer-context.xml\"</span>);\n        context.refresh();\n        System.out.println(<span class=\"hljs-string\">\"DemoService consumer (XML) is starting...\"</span>);\n        DemoService demoService = context.getBean(<span class=\"hljs-string\">\"demoService\"</span>, DemoService<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            System.out.println(demoService.sayName(<span class=\"hljs-string\">\"小马哥（mercyblitz）\"</span>));\n        }\n        context.close();\n    }\n}\n</code></pre>\n<h4>Run XML Configuration-driven Example</h4>\n<p>As such, start two DemoServiceProviderXmlBootstrap bootstraps and observe the changes in the Nacos registry service provider:</p>\n<p><img src=\"../../img/blog/dubbo-registry-nacos-5.png\" alt=\"image-20181213125527201\"></p>\n<p>The service version driven by the XML configuration is 2.0.0, so the registration service is correct.</p>\n<p>Run the service consumer bootstrap DemoServiceConsumerXmlBootstrap again and observe the console output:</p>\n<pre><code>Service [name :null , port : 20882] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20882] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20883] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20882] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20882] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20883] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20882] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20883] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20883] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\nService [name :null , port : 20883] sayName(&quot;小马哥（mercyblitz）&quot;) : Hello,小马哥（mercyblitz）\n</code></pre>\n<p>As a result, both operation and load balancing are normal due to the property <a href=\"http://demo.service.name\">demo.service.name</a> has not been added to the current example, the &quot;name&quot; information is output as null. For more information, please refer to: <a href=\"https://github.com/apache/dubbo/tree/master/dubbo-registry/dubbo-registry-nacos\">https://github.com/apache/dubbo/tree/master/dubbo-registry/dubbo-registry-nacos</a>.</p>\n<p>If you're interested in or fond of open source projects like Dubbo and Nacos, try clicking &quot;star&quot; to support them. The links are as follows:</p>\n<ul>\n<li>Apache Dubbo: <a href=\"https://github.com/apache/dubbo\">https://github.com/apache/dubbo</a></li>\n<li>Dubbo Nacos Registry: <a href=\"https://github.com/apache/dubbo/tree/master/dubbo-registry/dubbo-registry-nacos\">https://github.com/apache/dubbo/tree/master/dubbo-registry/dubbo-registry-nacos</a></li>\n<li>Alibaba Nacos: <a href=\"https://github.com/alibaba/nacos\">https://github.com/alibaba/nacos</a></li>\n</ul>\n",
  "link": "/en-us/blog/dubbo-registry-nacos-integration.html",
  "meta": {}
}