<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="Dubbo, test" />
	<meta name="description" content="This article introduces how to make service test with Dubbo." />
	<!-- 网页标签标题 -->
	<title>Dubbo Admin service test</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/blogDetail.css" />
</head>
<body>
	<div id="root"><div class="blog-detail-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/en-us/index.html">HOME</a></li><li class="menu-item menu-item-normal"><a href="/en-us/docs/user/quick-start.html">DOCS</a></li><li class="menu-item menu-item-normal"><a href="/en-us/docs/developers/developers_dev.html">DEVELOPERS</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/en-us/blog/index.html">BLOG</a></li><li class="menu-item menu-item-normal"><a href="/en-us/community/index.html">COMMUNITY</a></li><li class="menu-item menu-item-normal"><a href="/en-us/ecology/index.html">ECOSYSTEM</a></li><li class="menu-item menu-item-normal"><a href="/en-us/blog/download.html">DOWNLOAD</a></li></ul></div></div></header><section class="blog-content markdown-body"><h1>Dubbo Admin service test</h1>
<p>Based on the metadata of Dubbo2.7, Dubbo Admin implements the service test function, which can call the real service provider on the console through generalized call.</p>
<h2>Usage</h2>
<ul>
<li>
<p>Deploy the provider: You can download the demo <a href="https://github.com/nzomkxia/dubbo-demo">here</a>. This project is based on Spring Boot, which is convenient to start in the IDE or command line. For service testing, you only need to start  <code>dubbo-basic-provider</code>.</p>
</li>
<li>
<p>Service-seeking: After completing the server deployment, you can query the corresponding service on the Dubbo Admin's <code>service test</code> page:
<img src="../../img/blog/admin/testSearch.jpg" alt="testSearch"><br>
the information here is similar to the metadata, including the method name, parameter type and return value. Click the label on the right to enter the <code>service test</code> page.</p>
</li>
<li>
<p>Service test：
<img src="../../img/blog/admin/testSuccess.jpg" alt="testSuccess"><br>
<code>service test</code> page contains two json editor, the parameter's informations are all stored in a json format, where you need to fill in the corresponding parameter values (in this case, the number type is String ), after filling, click <code>execute</code> to initiate the call to the server, and the result of the call is displayed in the editor on the right. If the call fails, the detailed cause of the failure is displayed. Let's look at the example of the call failure.<br>
<img src="../../img/blog/admin/testFail.jpg" alt="testFail"></p>
<p>In this case, the Dubbo service provider's process is shut down before the service test is executed, you can see that the returned result is an <code>No provider availble</code> exception. As with normal calls, business and framework exceptions are returned in the results, for easy business troubleshooting.</p>
</li>
<li>
<p>Complex type parameters<br>
Consider the following methods and types in <code>UserService</code>:</p>
</li>
</ul>
<pre><code class="language-java"><span class="hljs-comment">//org.apache.dubbo.demo.api.UserService</span>
<span class="hljs-function">Result <span class="hljs-title">getUser</span><span class="hljs-params">(String name, UserInfoDO userInfoDO)</span></span>;
</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfoDO</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> LocationDO locationDO;
    <span class="hljs-keyword">private</span> DepartmentDO departmentDO;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"UserInfoDO{"</span> +
                <span class="hljs-string">"id="</span> + id +
                <span class="hljs-string">", locationDO="</span> + locationDO.toString() +
                <span class="hljs-string">", departmentDO="</span> + departmentDO.toString() +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentDO</span> </span>{

    <span class="hljs-keyword">private</span> String departName;
    <span class="hljs-keyword">private</span> LocationDO departLocation;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"DepartmentDO{"</span> +
                <span class="hljs-string">"departName='"</span> + departName + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", departLocation="</span> + departLocation.toString() +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocationDO</span> </span>{
    <span class="hljs-keyword">private</span> String address;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> postNum;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"LocationDO{"</span> +
                <span class="hljs-string">"address='"</span> + address + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", postNum="</span> + postNum +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>The parameters are complex complex type. When the service is tested, the value of each field will be filled out layer by layer, As shown below:<br>
<img src="../../img/blog/admin/complex.jpg" alt="complex">
It can also make successful call and the result is returned.</p>
<h2>Principle：Data source</h2>
<p>In the service test, the most important thing is the complete method signature, and the type information of the parameters, with which the values of each parameter can be filled step by step to assemble the complete service consumer. In Dubbo 2.7, the metadata center has been added. The method signature and parameter type information of Dubbo Admin is from here:<br>
<img src="../../img/blog/admin/metadata.png" alt="medatada">
As shown, the server will register the metadata information of the service to the metadata center when it runs,the format is as follows:</p>
<pre><code class="language-json">{
    ...
    "methods": [
        {
            "name": "sayHello",
            "parameterTypes": [
                "org.apache.dubbo.demo.model.User"
            ],
            "returnType": "org.apache.dubbo.demo.model.Result"
        },
      ...
    ],
    "types": [
        {
            "type": "char"
        },
        {
            "type": "long"
        },
        {
            "type": "org.apache.dubbo.demo.model.Result",
            "properties": {
                "msg": {
                    "type": "java.lang.String",
                    "properties": {
                        "value": {
                            "type": "char[]"
                        },
                        "hash": {
                            "type": "int"
                        }
                    }
                },
                "userName": {
                    "type": "java.lang.String",
                    "properties": {
                        "value": {
                            "type": "char[]"
                        },
                        "hash": {
                            "type": "int"
                        }
                    }
                }
            }
        },
        {
            "type": "org.apache.dubbo.demo.model.User",
            "properties": {
                "id": {
                    "type": "java.lang.Long",
                    "properties": {
                        "value": {
                            "type": "long"
                        }
                    }
                },
                "username": {
                    "type": "java.lang.Sring",
                    "properties": {
                        "value": {
                            "type": "char[]"
                        },
                        "hash": {
                            "type": "int"
                        }
                    }
                }
            }
        },
       ...
    ]
}
</code></pre>
<p>Related to service testing is the method and type information contained in <code>methods</code> and <code>types</code>. Based on this information, Dubbo Admin renders the parameters into the Json Editor of the service test page, where the user enters the values of each parameter and each member variable.</p>
<h2>Principle: Generalized calls</h2>
<p>With the parameter type, the next question is how to call to the server. In the traditional Dubbo RPC call, the client needs to rely on the server's API jar package ( refer to the <a href="https://github.com/nzomkxia/dubbo-demo/tree/master/dubbo-basic-consumer">dubbo-basic-consumer</a> in the previous demo ), which is unlikely for Dubbo Admin, because the up and down of services are dynamic, Dubbo Admin can not dynamically increase the jar package dependencies, so you need to use the <strong>generalization call</strong> in Dubbo , which means that in the absence of the server API interface, the client initiates a service call through the  <code>GenericService</code> interface, and the data objects in return values are represented by maps. The generalization call doesn't require special processing on the server side, only need to be initiated by the client side.</p>
<h2>Summary and outlook</h2>
<p>This article briefly introduces the usage and principle of service testing, and will further enhance this function in the future, such as processing the parameter types of abstract classes, importing parameter values from json files, supporting the saving of parameter values, etc., to facilitate regression testing of the service interface.</p>
</section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>ASF</dt><dd><a href="http://www.apache.org" target="_self">Foundation</a></dd><dd><a href="http://www.apache.org/licenses/" target="_self">License</a></dd><dd><a href="http://www.apache.org/events/current-event" target="_self">Events</a></dd><dd><a href="http://www.apache.org/foundation/sponsorship.html" target="_self">Sponsorship</a></dd><dd><a href="http://www.apache.org/foundation/thanks.html" target="_self">Thanks</a></dd></dl></div><div class="col col-4"><dl><dt>Documentation</dt><dd><a href="/en-us/docs/user/quick-start.html" target="_self">Quick start</a></dd><dd><a href="/en-us/docs/dev/build.html" target="_self">Developer guide</a></dd><dd><a href="/en-us/docs/admin/ops/dubbo-ops.html" target="_self">Admin manual</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">Report a Doc Issue</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">Edit This Page on GitHub</a></dd></dl></div><div class="col col-4"><dl><dt>Resources</dt><dd><a href="/en-us/blog/index.html" target="_self">Blog</a></dd><dd><a href="/en-us/community/index.html" target="_self">Community</a></dd><dd><a href="https://www.apache.org/security/" target="_self">Security</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/blogDetail.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>